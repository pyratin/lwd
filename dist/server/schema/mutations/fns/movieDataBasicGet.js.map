{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieDataBasicGet.js"],"names":["titleEncodedGet","title","encodeURIComponent","pageMobileSectionQueryGet","trim","moviePageSectionTextsGetFn","json","anchorName","section","remaining","sections","find","anchor","match","RegExp","text","moviePageSectionTextsGet","anchorNames","reduce","memo","sectionText","replace","plotCulledGet","_plot","plot","sentence","length","paragraphIndex","console","log","query","poster","lead","image","Object","values","urls","castText","plotText","cast"],"mappings":"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","sourcesContent":["'use strict';\n\nimport mediawikiFetch from './mediawikiFetch';\nimport movieDataBasicPlotGet from './movieDataBasicPlotGet';\nimport movieDataBasicCastGet from './movieDataBasicCastGet';\n\nconst titleEncodedGet = (\n  title\n) => {\n\n  return encodeURIComponent(\n    title\n  );\n};\n\nconst pageMobileSectionQueryGet = (\n  title\n) => {\n\n  return `\n    https://en.wikipedia.org/api/rest_v1/page/mobile-sections/${\n      titleEncodedGet(\n        title\n      )\n    }\n  `\n    .trim();\n};\n\nconst moviePageSectionTextsGetFn = (\n  json,\n  anchorName\n) => {\n\n  const section = json.remaining.sections\n    .find(\n      (\n        {\n          anchor\n        }\n      ) => {\n\n        return (\n          anchor.match(\n            new RegExp(\n              `\n                ${\n                  anchorName\n                }\n              `\n                .trim(),\n              'i'\n            )\n          )\n        );\n      }\n    );\n\n  return (\n    section\n  ) &&\n    section.text;\n};\n\nconst moviePageSectionTextsGet = (\n  json,\n  anchorNames\n) => {\n\n  return anchorNames.reduce(\n    (\n      memo,\n      anchorName\n    ) => {\n\n      let sectionText = moviePageSectionTextsGetFn(\n        json,\n        anchorName\n      );\n\n      sectionText = sectionText?.replace(\n        /\\n/g,\n        ' '\n      );\n\n      sectionText = sectionText?.replace(\n        /\\s{2,}/g,\n        ' '\n      );\n\n      return [\n        ...memo,\n        sectionText\n      ];\n    },\n    []\n  );\n};\n\nconst plotCulledGet = (\n  _plot\n) => {\n\n  const plot = (\n    _plot\n  ) &&\n    _plot.reduce(\n      (\n        memo,\n        sentence\n      ) => {\n\n        if (\n          (\n            memo.length >= \n            3\n          ) &&\n          (\n            !memo[\n              memo.length - 1\n            ]?.text\n              .match(/\\s...,$/)\n          ) &&\n          (\n            (\n              memo[\n                memo.length - 1\n              ]?.paragraphIndex !==\n              sentence.paragraphIndex\n            ) ||\n            (\n              memo.length >=\n              6\n            )\n          )\n        ) {\n\n          return (\n            memo\n          );\n        }\n\n        return [\n          ...memo,\n          sentence\n        ];\n      },\n      []\n    );\n\n  return (\n    plot\n  );\n};\n\nexport default async (\n  title\n) => {\n\n  // eslint-disable-next-line no-console\n  console.log(\n    `\n      movieDataBasicCastGet: ${\n        title\n      }\n    `\n      .trim()\n  );\n\n  const query = pageMobileSectionQueryGet(\n    title\n  );\n\n  const json = await mediawikiFetch(\n    query\n  );\n\n  const poster = (\n    json.lead?.image\n  ) ?\n    Object.values(\n      json.lead.image.urls\n    )[\n      0\n    ]:\n    null;\n\n  const anchorNames = [\n    'Cast',\n    'Plot'\n  ];\n\n  let [\n    castText,\n    plotText\n  ] = moviePageSectionTextsGet(\n    json,\n    anchorNames\n  );\n\n  let plot = movieDataBasicPlotGet(\n    plotText\n  );\n\n  const cast = movieDataBasicCastGet(\n    castText,\n    plot\n  );\n\n  plot = plotCulledGet(\n    plot\n  );\n\n  return {\n    title,\n    poster,\n    cast,\n    plot,\n    castText,\n    plotText\n  };\n};\n"],"file":"movieDataBasicGet.js"}