{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieDataBasicGet.js"],"names":["titleEncodedGet","title","encodeURIComponent","pageMobileSectionQueryGet","trim","moviePageSectionTextsGetFn","json","anchorName","section","remaining","sections","find","anchor","match","RegExp","text","sectionTextCleanedGet","sectionText","replace","moviePageSectionTextsGet","anchorNames","reduce","memo","plotLimit","console","log","query","poster","lead","image","Object","values","urls","castText","plotText","plot","cast"],"mappings":"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","sourcesContent":["'use strict';\n\nimport latinize from 'latinize';\n\nimport mediawikiFetch from './mediawikiFetch';\nimport movieDataBasicPlotGet from './movieDataBasicPlotGet';\nimport movieDataBasicCastGet from './movieDataBasicCastGet';\n\nconst titleEncodedGet = (\n  title\n) => {\n\n  return encodeURIComponent(\n    title\n  );\n};\n\nconst pageMobileSectionQueryGet = (\n  title\n) => {\n\n  return `\n    https://en.wikipedia.org/api/rest_v1/page/mobile-sections/${\n      titleEncodedGet(\n        title\n      )\n    }\n  `\n    .trim();\n};\n\nconst moviePageSectionTextsGetFn = (\n  json,\n  anchorName\n) => {\n\n  const section = json.remaining.sections\n    .find(\n      (\n        {\n          anchor\n        }\n      ) => {\n\n        return (\n          anchor.match(\n            new RegExp(\n              `\n                ${\n                  anchorName\n                }\n              `\n                .trim(),\n              'i'\n            )\n          )\n        );\n      }\n    );\n\n  return (\n    section\n  ) &&\n    section.text;\n};\n\nconst sectionTextCleanedGet = (\n  sectionText\n) => {\n\n  sectionText = sectionText?.replace(\n    /\\n/g,\n    ' '\n  );\n\n  sectionText = sectionText?.replace(\n    /\\s{2,}/g,\n    ' '\n  );\n\n  sectionText = latinize(\n    sectionText\n  );\n\n  sectionText = sectionText?.replace(\n    /((?:[A-Z][a-z]*.?)*)(\\s?)\"([A-Za-z.]+)\"(\\s?)((?:[A-Z][a-z]+)*)/g,\n    '$1$2$3$4$5'\n  );\n\n  return (\n    sectionText\n  );\n};\n\nconst moviePageSectionTextsGet = (\n  json,\n  anchorNames\n) => {\n\n  return anchorNames.reduce(\n    (\n      memo,\n      anchorName\n    ) => {\n\n      let sectionText = moviePageSectionTextsGetFn(\n        json,\n        anchorName\n      );\n\n      sectionText = sectionTextCleanedGet(\n        sectionText\n      );\n\n      return [\n        ...memo,\n        sectionText\n      ];\n    },\n    []\n  );\n};\n\nexport default async (\n  title,\n  plotLimit\n) => {\n\n  // eslint-disable-next-line no-console\n  console.log(\n    `\n      movieDataBasicGet: ${\n        title\n      }\n    `\n      .trim()\n  );\n\n  const query = pageMobileSectionQueryGet(\n    title\n  );\n\n  const json = await mediawikiFetch(\n    query\n  );\n\n  const poster = (\n    json.lead?.image\n  ) ?\n    Object.values(\n      json.lead.image.urls\n    )[\n      0\n    ]:\n    null;\n\n  const anchorNames = [\n    'Cast',\n    'Plot'\n  ];\n\n  let [\n    castText,\n    plotText\n  ] = moviePageSectionTextsGet(\n    json,\n    anchorNames\n  );\n\n  let plot = movieDataBasicPlotGet(\n    plotText,\n    plotLimit\n  );\n\n  const cast = movieDataBasicCastGet(\n    castText\n  );\n\n  return {\n    title,\n    poster,\n    cast,\n    plot,\n    castText,\n    plotText\n  };\n};\n"],"file":"movieDataBasicGet.js"}