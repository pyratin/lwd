{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/cardsCharacterAssignedGet.js"],"names":["charactersPreviousGet","cards","reduce","memo","character","charactersWeightedGetFn","charactersPrevious","_charactersPrevious","index","actor","text","count","nearest","length","charactersWeightedGet","characters","_characterAssignedGetFn","charactersWeighted","sort","a","b","castIndex","characterAssignedGetFn","card","_cards","_card"],"mappings":"AAAA;;;;;;;;;;;;;;;;;AAEA,IAAMA,qBAAqB,GAAG,SAAxBA,qBAAwB,CAC5BC,KAD4B,EAEzB;AAEH,SAAOA,KAAK,CAACC,MAAN,CACL,UACEC,IADF,QAKK;AAAA,QAFDC,SAEC,QAFDA,SAEC;;AAEH,QACEA,SADF,EAEE;AAEA,2DACKD,IADL,IAEEC,SAFF;AAID;;AAED,WACED,IADF;AAGD,GArBI,EAsBL,EAtBK,CAAP;AAwBD,CA5BD;;AA8BA,IAAME,uBAAuB,GAAG,SAA1BA,uBAA0B,CAC9BD,SAD8B,EAE9BE,kBAF8B,EAG3B;AAEH,SAAOA,kBAAkB,CAACJ,MAAnB,CACL,UACEC,IADF,EAEEI,mBAFF,EAGEC,KAHF,EAIK;AAEH,QACED,mBAAmB,CAACE,KAApB,CAA0BC,IAA1B,KACAN,SAAS,CAACK,KAAV,CAAgBC,IAFlB,EAGE;AAEA,6CACKP,IADL;AAEEQ,QAAAA,KAAK,EAAER,IAAI,CAACQ,KAAL,GAAa,CAFtB;AAGEC,QAAAA,OAAO,EAAEN,kBAAkB,CAACO,MAAnB,IACPL,KAAK,GAAG,CADD;AAHX;AAOD;;AAED,WACEL,IADF;AAGD,GAxBI,kCA0BAC,SA1BA;AA2BHO,IAAAA,KAAK,EAAE,CA3BJ;AA4BHC,IAAAA,OAAO,EAAEN,kBAAkB,CAACO;AA5BzB,KAAP;AA+BD,CApCD;;AAsCA,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAC5BC,UAD4B,EAE5BT,kBAF4B,EAGzB;AAEH,SAAOS,UAAU,CAACb,MAAX,CACL,UACEC,IADF,EAEEC,SAFF,EAGK;AAEH,yDACKD,IADL,IAEEE,uBAAuB,CACrBD,SADqB,EAErBE,kBAFqB,CAFzB;AAOD,GAbI,EAcL,EAdK,CAAP;AAgBD,CArBD;;AAuBA,IAAMU,uBAAuB,GAAG,SAA1BA,uBAA0B,CAC9BC,kBAD8B,EAE3B;AAEH,SAAOA,kBAAkB,CAACC,IAAnB,CACL,UACEC,CADF,EACKC,CADL,EAEK;AAEH,YACE,IADF;AAIE,WACED,CAAC,CAACP,OAAF,GACAQ,CAAC,CAACR,OAFJ;AAKE,eAAO,CAAC,CAAR;;AAEF,WACEQ,CAAC,CAACR,OAAF,GACAO,CAAC,CAACP,OAFJ;AAKE,eAAO,CAAP;;AAEF,WACEO,CAAC,CAACR,KAAF,GACAS,CAAC,CAACT,KAFJ;AAKE,eAAO,CAAP;;AAEF,WACES,CAAC,CAACT,KAAF,GACAQ,CAAC,CAACR,KAFJ;AAKE,eAAO,CAAC,CAAR;;AAEF,WACEQ,CAAC,CAACE,SAAF,GACAD,CAAC,CAACC,SAFJ;AAKE,eAAO,CAAP;;AAEF,WACED,CAAC,CAACC,SAAF,GACAF,CAAC,CAACE,SAFJ;AAKE,eAAO,CAAC,CAAR;AA5CJ;AA8CD,GAnDI,EAqDL,CArDK,CAAP;AAuDD,CA3DD;;AA6DA,IAAMC,sBAAsB,GAAG,SAAzBA,sBAAyB,CAC7BC,IAD6B,EAE7BjB,kBAF6B,EAG1B;AAEH,MAAMW,kBAAkB,GAAGH,qBAAqB,CAC9CS,IAAI,CAACR,UADyC,EAE9CT,kBAF8C,CAAhD;;AAKA,MAAIF,SAAS,GAAGY,uBAAuB,CACrCC,kBADqC,CAAvC;;AAIOb,EAAAA,SAAP,aAAOA,SAAP,4BAAOA,SAAS,CAAEO,KAAlB;AAEOP,EAAAA,SAAP,aAAOA,SAAP,4BAAOA,SAAS,CAAEQ,OAAlB;AAEA,yCACKW,IADL;AAEEnB,IAAAA,SAAS,EAATA;AAFF;AAID,CAtBD;;eAwBe,kBACboB,MADa,EAEV;AAEH,MAAMvB,KAAK,GAAGuB,MAAM,CAACtB,MAAP,CACZ,UACEC,IADF,EAEEsB,KAFF,EAGK;AAEH,QAAMnB,kBAAkB,GAAGN,qBAAqB,CAC9CG,IAD8C,CAAhD;AAIA,QAAMoB,IAAI,GAAGD,sBAAsB,CACjCG,KADiC,EAEjCnB,kBAFiC,CAAnC;AAKA,yDACKH,IADL,IAEEoB,IAFF;AAID,GAnBW,EAoBZ,EApBY,CAAd;;AAuBA,SACEtB,KADF;AAGD,C","sourcesContent":["'use strict';\n\nconst charactersPreviousGet = (\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      memo,\n      {\n        character\n      }\n    ) => {\n\n      if (\n        character\n      ) {\n\n        return [\n          ...memo,\n          character\n        ];\n      }\n\n      return (\n        memo\n      );\n    },\n    []\n  );\n};\n\nconst charactersWeightedGetFn = (\n  character,\n  charactersPrevious\n) => {\n\n  return charactersPrevious.reduce(\n    (\n      memo,\n      _charactersPrevious,\n      index\n    ) => {\n\n      if (\n        _charactersPrevious.actor.text ===\n        character.actor.text\n      ) {\n\n        return {\n          ...memo,\n          count: memo.count + 1,\n          nearest: charactersPrevious.length - (\n            index + 1\n          )\n        };\n      }\n\n      return (\n        memo\n      );\n    },\n    {\n      ...character,\n      count: 0,\n      nearest: charactersPrevious.length\n    }\n  );\n};\n\nconst charactersWeightedGet = (\n  characters,\n  charactersPrevious\n) => {\n\n  return characters.reduce(\n    (\n      memo,\n      character\n    ) => {\n\n      return [\n        ...memo,\n        charactersWeightedGetFn(\n          character,\n          charactersPrevious\n        )\n      ];\n    },\n    []\n  );\n};\n\nconst _characterAssignedGetFn = (\n  charactersWeighted\n) => {\n\n  return charactersWeighted.sort(\n    (\n      a, b\n    ) => {\n\n      switch (\n        true\n      ) {\n\n        case (\n          a.nearest >\n          b.nearest\n        ) :\n\n          return -1;\n\n        case (\n          b.nearest >\n          a.nearest\n        ) :\n\n          return 1;\n\n        case (\n          a.count >\n          b.count\n        ) :\n\n          return 1;\n\n        case (\n          b.count >\n          a.count\n        ) :\n\n          return -1;\n\n        case (\n          a.castIndex >\n          b.castIndex\n        ) :\n\n          return 1;\n\n        case (\n          b.castIndex >\n          a.castIndex\n        ) :\n\n          return -1;\n      }\n    }\n  )[\n    0\n  ];\n};\n\nconst characterAssignedGetFn = (\n  card,\n  charactersPrevious\n) => {\n\n  const charactersWeighted = charactersWeightedGet(\n    card.characters,\n    charactersPrevious\n  );\n\n  let character = _characterAssignedGetFn(\n    charactersWeighted\n  );\n\n  delete character?.count;\n\n  delete character?.nearest;\n\n  return {\n    ...card,\n    character\n  };\n};\n\nexport default (\n  _cards\n) => {\n\n  const cards = _cards.reduce(\n    (\n      memo,\n      _card\n    ) => {\n\n      const charactersPrevious = charactersPreviousGet(\n        memo\n      );\n\n      const card = characterAssignedGetFn(\n        _card,\n        charactersPrevious\n      );\n\n      return [\n        ...memo,\n        card\n      ];\n    },\n    []\n  );\n\n  return (\n    cards\n  );\n};\n"],"file":"cardsCharacterAssignedGet.js"}