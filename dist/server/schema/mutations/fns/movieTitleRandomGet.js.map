{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieTitleRandomGet.js"],"names":["categoryGet","_category","queryGet","cmstart","cmend","category","trim","movieTitleRandomGetFn","res","categorymembers","query","title","Math","floor","random","length","console","log","movieDataBasic","plot","cast","characters","segments","cards","characterTexts","reduce","memo","card","character","text","Set","movieTitleRandomGet","year","month","dateString","Date","toISOString","add","then"],"mappings":"AAAA;;;;;;;;;;;;;;;AAEA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AAGA,IAAMA,WAAW,GAAG,SAAdA,WAAc,CAClBC,SADkB,EAEf;AAEH,UACEA,SADF;AAIE,SACE,OADF;AAIE,aAAO,sBAAP;;AAEF,SACE,OADF;AAIE,aAAO,sBAAP;;AAEF;AAEE,aAAO,wBAAP;AAlBJ;AAoBD,CAxBD;;AA0BA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CACfC,OADe,EAEfC,KAFe,EAGfH,SAHe,EAIZ;AAEH,MAAMI,QAAQ,GAAGL,WAAW,CAC1BC,SAD0B,CAA5B;AAIA,SAAO,sIAEHE,OAFG,oBAIHC,KAJG,+BAMHC,QANG,UASJC,IATI,EAAP;AAUD,CApBD;;AAsBA,IAAMC,qBAAqB;AAAA,2FAAG,iBAC5BC,GAD4B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAItBC,YAAAA,eAJsB,GAIJD,GAAG,CAACE,KAAJ,CAAUD,eAJN;AAMtBE,YAAAA,KANsB,4BAMdF,eAAe,CAC3BG,IAAI,CAACC,KAAL,CACED,IAAI,CAACE,MAAL,KACAL,eAAe,CAACM,MAFlB,CAD2B,CAND,0DAMd,sBAKXJ,KAXyB;;AAAA,gBAczBA,KAdyB;AAAA;AAAA;AAAA;;AAAA,6CAkBxB,IAlBwB;;AAAA;AAsB5B;AACAK,YAAAA,OAAO,CAACC,GAAR,CACE,yBAEIN,KAFJ,YAKGL,IALH,EADF;AAvB4B;AAAA,mBAgCC,mCAC3BK,KAD2B,CAhCD;;AAAA;AAgCtBO,YAAAA,cAhCsB;;AAAA,kBAqC1B,EAACA,cAAD,aAACA,cAAD,uBAACA,cAAc,CAAEC,IAAjB,KACA,EAACD,cAAD,aAACA,cAAD,uBAACA,cAAc,CAAEE,IAAjB,CAtC0B;AAAA;AAAA;AAAA;;AAAA,6CA0CxB,IA1CwB;;AAAA;AA8CtBC,YAAAA,UA9CsB,GA8CT,oCACjBH,cAAc,CAACE,IADE,EAEjBF,cAAc,CAACC,IAFE,CA9CS;AAmDtBG,YAAAA,QAnDsB,GAmDX,6BACfJ,cAAc,CAACC,IADA,EAEfE,UAFe,CAnDW;AAwDtBE,YAAAA,KAxDsB,GAwDd,2CACZD,QADY,CAxDc;AA4DtBE,YAAAA,cA5DsB,GA4DLD,KAAK,CAACE,MAAN,CACrB,UACEC,IADF,EAEEC,IAFF,EAGK;AAEH,kBACEA,IAAI,CAACC,SAAL,IACAD,IAAI,CAACC,SAAL,CAAeC,IAFjB,EAGE;AAEA,2DACK,IAAIC,GAAJ,+CAEIJ,IAFJ,IAGCC,IAAI,CAACC,SAAL,CAAeC,IAHhB,GADL;AAQD;;AAED,qBACEH,IADF;AAGD,aAxBoB,EAyBrB,EAzBqB,CA5DK;;AAAA,kBAyF1BF,cAAc,CAACT,MAAf,GACA,CA1F0B;AAAA;AAAA;AAAA;;AAAA,6CA8FxB,IA9FwB;;AAAA;AAAA,6CAmG1BJ,KAnG0B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAArBJ,qBAAqB;AAAA;AAAA;AAAA,GAA3B;;AAuGA,IAAMwB,mBAAmB,GAAG,SAAtBA,mBAAsB,CAC1B1B,QAD0B,EAEvB;AAEH,MAAM2B,IAAI,GAAG,OAEXpB,IAAI,CAACC,KAAL,CACED,IAAI,CAACE,MAAL,MAEE,0BACGkB,IADH,KAEA,IAJF,CADF,CAFF;AAYA,MAAMC,KAAK,GAAG,IAEZrB,IAAI,CAACC,KAAL,CACED,IAAI,CAACE,MAAL,KACA,EAFF,CAFF;AAQA,MAAMoB,UAAU,GAAG,gBAEfF,IAFe,cAIfC,KAJe,aAOhB3B,IAPgB,EAAnB;AASA,MAAMH,OAAO,GAAG,wBACd,IAAIgC,IAAJ,CACED,UADF,CADc,EAKbE,WALa,EAAhB;AAOA,MAAMhC,KAAK,GAAG,wBACZD,OADY,EAGXkC,GAHW,CAIV,CAJU,EAIP,OAJO,EAMXD,WANW,EAAd;AAQA,MAAM1B,KAAK,GAAGR,QAAQ,CACpBC,OADoB,EAEpBC,KAFoB,EAGpBC,QAHoB,CAAtB;AAMA,SAAO,gCACLK,KADK,EAGJ4B,IAHI;AAAA,8FAIH,kBACE9B,GADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAIsBD,qBAAqB,CACvCC,GADuC,CAJ3C;;AAAA;AAIQG,cAAAA,KAJR;;AAAA,kBASKA,KATL;AAAA;AAAA;AAAA;;AAYI;AACAK,cAAAA,OAAO,CAACC,GAAR,CACE,+CAEIe,IAFJ,cAIIC,KAJJ,uBAOG3B,IAPH,EADF;AAbJ,gDAwBWyB,mBAAmB,CACxB,iCAEI1B,QAFJ,oBAKGC,IALH,EADwB,CAxB9B;;AAAA;AAAA,gDAmCIK,KAnCJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAJG;;AAAA;AAAA;AAAA;AAAA,MAAP;AA2CD,CAjGD;;eAmGeoB,mB","sourcesContent":["'use strict';\n\nimport moment from 'moment';\n\nimport mediawikiFetch from './mediawikiFetch';\nimport movieDataBasicGet from './movieDataBasicGet';\nimport charactersBasicGet from './charactersBasicGet';\nimport segmentsGet from '../fns/segmentsGet';\nimport cardsCharacterAssignedGet from\n  './cardsCharacterAssignedGet';\n\nconst categoryGet = (\n  _category\n) => {\n\n  switch (\n    _category\n  ) {\n\n    case (\n      'tamil'\n    ) :\n\n      return 'tamil-language_films';\n\n    case (\n      'hindi'\n    ) :\n\n      return 'hindi-language_films';\n\n    default :\n\n      return 'English-language_films';\n  }\n};\n\nconst queryGet = (\n  cmstart,\n  cmend,\n  _category\n) => {\n\n  const category = categoryGet(\n    _category \n  );\n\n  return `\n    https://en.wikipedia.org/w/api.php?action=query&list=categorymembers&format=json&cmlimit=500&cmsort=timestamp&cmstart=${\n      cmstart\n    }&cmend=${\n      cmend\n    }&cmtitle=Category:${\n      category\n    }\n  `\n    .trim();\n};\n\nconst movieTitleRandomGetFn = async (\n  res\n) => {\n\n  const categorymembers = res.query.categorymembers;\n\n  const title = categorymembers[\n    Math.floor(\n      Math.random() *\n      categorymembers.length\n    )\n  ]?.title;\n\n  if (\n    !title\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  //eslint-disable-next-line\n  console.log(\n    `\n      title: ${\n        title\n      }\n    `\n      .trim()\n  );\n\n  const movieDataBasic = await movieDataBasicGet(\n    title\n  );\n\n  if (\n    !movieDataBasic?.plot ||\n    !movieDataBasic?.cast\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  const characters = charactersBasicGet(\n    movieDataBasic.cast,\n    movieDataBasic.plot\n  );\n\n  const segments = segmentsGet(\n    movieDataBasic.plot,\n    characters\n  );\n\n  const cards = cardsCharacterAssignedGet(\n    segments\n  );\n\n  const characterTexts = cards.reduce(\n    (\n      memo,\n      card\n    ) => {\n\n      if (\n        card.character &&\n        card.character.text\n      ) {\n\n        return[\n          ...new Set(\n            [\n              ...memo,\n              card.character.text\n            ]\n          )\n        ];\n      }\n\n      return (\n        memo\n      );\n    },\n    []\n  );\n\n  if (\n    characterTexts.length <\n    3\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  return (\n    title\n  );\n};\n\nconst movieTitleRandomGet = (\n  category\n) => {\n\n  const year = 2000 +\n  (\n    Math.floor(\n      Math.random() *\n      (\n        moment()\n          .year() -\n        2000\n      )\n    )\n  );\n\n  const month = 1 +\n  (\n    Math.floor(\n      Math.random() *\n      12\n    )\n  );\n\n  const dateString = `\n    ${\n      year\n    }-${\n      month\n    }-01\n  `\n    .trim();\n\n  const cmstart = moment(\n    new Date(\n      dateString\n    )\n  )\n    .toISOString();\n\n  const cmend = moment(\n    cmstart\n  )\n    .add(\n      1, 'month'\n    )\n    .toISOString();\n\n  const query = queryGet(\n    cmstart,\n    cmend,\n    category\n  );\n\n  return mediawikiFetch(\n    query\n  )\n    .then(\n      async (\n        res\n      ) => {\n\n        const title = await movieTitleRandomGetFn(\n          res\n        );\n\n        if (\n          !title\n        ) {\n\n          // eslint-disable-next-line\n          console.log(\n            `\n              movieTitleRandomGet: ${\n                year\n              }-${\n                month\n              }-01\n            `\n              .trim()\n          );\n\n          return movieTitleRandomGet(\n            `\n              random:${\n                category\n              }\n            `\n              .trim()\n          );\n        }\n\n        return (\n          title\n        );\n      }\n    );\n};\n\nexport default movieTitleRandomGet;\n"],"file":"movieTitleRandomGet.js"}