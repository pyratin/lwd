{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieTitleRandomGet.js"],"names":["categoryGet","_category","queryGet","cmstart","cmend","category","trim","movieTitleRandomGetFn","res","categorymembers","query","title","Math","floor","random","length","movieDataBasic","plot","cast","characters","segments","cards","characterTexts","reduce","memo","card","character","text","Set","console","log","movieTitleRandomGet","year","month","dateString","Date","toISOString","add","then"],"mappings":"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","sourcesContent":["'use strict';\n\nimport moment from 'moment';\n\nimport mediawikiFetch from './mediawikiFetch';\nimport movieDataBasicGet from './movieDataBasicGet';\nimport charactersBasicGet from './charactersBasicGet';\nimport segmentsGet from '../fns/segmentsGet';\nimport cardsBasicGet from\n  './cardsBasicGet';\n\nconst categoryGet = (\n  _category\n) => {\n\n  switch (\n    _category\n  ) {\n\n    case (\n      'tamil'\n    ) :\n\n      return 'tamil-language_films';\n\n    case (\n      'hindi'\n    ) :\n\n      return 'hindi-language_films';\n\n    default :\n\n      return 'English-language_films';\n  }\n};\n\nconst queryGet = (\n  cmstart,\n  cmend,\n  category\n) => {\n\n  return `\n    https://en.wikipedia.org/w/api.php?action=query&list=categorymembers&format=json&cmlimit=500&cmsort=timestamp&cmstart=${\n      cmstart\n    }&cmend=${\n      cmend\n    }&cmtitle=Category:${\n      category\n    }\n  `\n    .trim();\n};\n\nconst movieTitleRandomGetFn = async (\n  res\n) => {\n\n  const categorymembers = res.query.categorymembers;\n\n  const title = categorymembers[\n    Math.floor(\n      Math.random() *\n      categorymembers.length\n    )\n  ]?.title;\n\n  if (\n    !title\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  const movieDataBasic = await movieDataBasicGet(\n    title\n  );\n\n  if (\n    !movieDataBasic?.plot ||\n    !movieDataBasic?.cast\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  const characters = charactersBasicGet(\n    movieDataBasic.cast,\n    movieDataBasic.plot\n  );\n\n  const segments = segmentsGet(\n    movieDataBasic.plot,\n    characters\n  );\n\n  const cards = cardsBasicGet(\n    segments\n  );\n\n  const characterTexts = cards.reduce(\n    (\n      memo,\n      card\n    ) => {\n\n      if (\n        card.character &&\n        card.character.text\n      ) {\n\n        return[\n          ...new Set(\n            [\n              ...memo,\n              card.character.text\n            ]\n          )\n        ];\n      }\n\n      return (\n        memo\n      );\n    },\n    []\n  );\n\n  //eslint-disable-next-line\n  console.log(\n    `\n      title: ${\n        title\n      }, cast: ${\n        !!movieDataBasic.cast\n      }, plot: ${\n        !!movieDataBasic.plot\n      }, characters: ${\n        characterTexts.length\n      }\n    `\n      .trim()\n  );\n\n  if (\n    characterTexts.length <\n    1\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  return (\n    title\n  );\n};\n\nconst movieTitleRandomGet = (\n  _category\n) => {\n\n  const year = 2000 +\n  (\n    Math.floor(\n      Math.random() *\n      (\n        moment()\n          .year() -\n        2000\n      )\n    )\n  );\n\n  const month = 1 +\n  (\n    Math.floor(\n      Math.random() *\n      12\n    )\n  );\n\n  const dateString = `\n    ${\n      year\n    }-${\n      month\n    }-01\n  `\n    .trim();\n\n  const cmstart = moment(\n    new Date(\n      dateString\n    )\n  )\n    .toISOString();\n\n  const cmend = moment(\n    cmstart\n  )\n    .add(\n      1, 'year'\n    )\n    .toISOString();\n\n  const category = categoryGet(\n    _category\n  );\n\n  const query = queryGet(\n    cmstart,\n    cmend,\n    category\n  );\n\n  return mediawikiFetch(\n    query\n  )\n    .then(\n      async (\n        res\n      ) => {\n\n        const title = await movieTitleRandomGetFn(\n          res\n        );\n\n        if (\n          !title\n        ) {\n\n          // eslint-disable-next-line\n          console.log(\n            `\n              movieTitleRandomGet: ${\n                year\n              }-${\n                month\n              }-01\n            `\n              .trim()\n          );\n\n          return movieTitleRandomGet(\n            _category\n          );\n        }\n\n        return (\n          title\n        );\n      }\n    );\n};\n\nexport default movieTitleRandomGet;\n"],"file":"movieTitleRandomGet.js"}