{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieTitleRandomGet.js"],"names":["categoryGet","_category","queryGet","text","split","year","category","cmstart","Date","trim","toISOString","cmend","add","movieTitleRandomGet","query","then","res","categorymembers","title","Math","floor","random","length","movieDataBasic","plot","cast"],"mappings":"AAAA;;;;;;;;;;;;;;;AAEA;;AAEA;;AACA;;AAEA,IAAMA,WAAW,GAAG,SAAdA,WAAc,CAClBC,SADkB,EAEf;AAEH,UACEA,SADF;AAIE,SACE,OADF;AAIE,aAAO,sBAAP;;AAEF,SACE,OADF;AAIE,aAAO,sBAAP;;AAEF;AAEE,aAAO,wBAAP;AAlBJ;AAoBD,CAxBD;;AA0BA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CACfC,IADe,EAEZ;AAAA,oBAKCA,IAAI,CAACC,KAAL,CACF,GADE,CALD;AAAA;AAAA,MAGDH,SAHC;AAAA,MAIDI,IAJC;;AASH,MAAMC,QAAQ,GAAGN,WAAW,CAC1BC,SAD0B,CAA5B;AAIA,MAAMM,OAAO,GAAG,IAAIC,IAAJ,CACd,wBACE,oBAEIH,IAFJ,oBAKGI,IALH,EADF,CADc,EAUbC,WAVa,EAAhB;AAYA,MAAMC,KAAK,GAAG,IAAIH,IAAJ,CACZ,wBACED,OADF,EAGGK,GAHH,CAII,CAJJ,EAIO,MAJP,CADY,EAQXF,WARW,EAAd;AAUA,SAAO,sIAEHH,OAFG,oBAIHI,KAJG,+BAMHL,QANG,UASJG,IATI,EAAP;AAUD,CA/CD;;AAiDA,IAAMI,mBAAmB,GAAG,SAAtBA,mBAAsB,CAC1BV,IAD0B,EAEvB;AAEH,MAAMW,KAAK,GAAGZ,QAAQ,CACpBC,IADoB,CAAtB;AAIA,SAAO,gCACLW,KADK,EAGJC,IAHI,CAIH,UACEC,GADF,EAEK;AAEH,QAAMC,eAAe,GAAGD,GAAG,CAACF,KAAJ,CAAUG,eAAlC;AAEA,QAAMC,KAAK,GAAGD,eAAe,CAC3BE,IAAI,CAACC,KAAL,CACED,IAAI,CAACE,MAAL,KACAJ,eAAe,CAACK,MAFlB,CAD2B,CAAf,CAMXJ,KANH;AAQA,WACEA,KADF;AAGD,GArBE,EAuBJH,IAvBI;AAAA,6FAwBH,iBACEG,KADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAI+B,mCAC3BA,KAD2B,CAJ/B;;AAAA;AAIQK,cAAAA,cAJR;AAAA,+CASIA,cAAc,CAACC,IAAf,IACAD,cAAc,CAACE,IAFV,GAILP,KAJK,GAKLL,mBAAmB,CACjBV,IADiB,CAbvB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAxBG;;AAAA;AAAA;AAAA;AAAA,MAAP;AA0CD,CAlDD;;eAoDeU,mB","sourcesContent":["'use strict';\n\nimport moment from 'moment';\n\nimport mediawikiFetch from './mediawikiFetch';\nimport movieDataBasicGet from './movieDataBasicGet';\n\nconst categoryGet = (\n  _category\n) => {\n\n  switch (\n    _category\n  ) {\n\n    case (\n      'tamil'\n    ) :\n\n      return 'tamil-language_films';\n\n    case (\n      'hindi'\n    ) :\n\n      return 'hindi-language_films';\n\n    default :\n\n      return 'English-language_films';\n  }\n};\n\nconst queryGet = (\n  text\n) => {\n\n  const [\n    _category,\n    year\n  ] = text.split(\n    /:/\n  );\n\n  const category = categoryGet(\n    _category \n  );\n\n  const cmstart = new Date(\n    moment(\n      `\n        ${\n          year\n        }-01-01\n      `\n        .trim()\n    )\n  )\n    .toISOString();\n\n  const cmend = new Date(\n    moment(\n      cmstart\n    )\n      .add(\n        1, 'year'\n      )\n  )\n    .toISOString();\n\n  return `\n    https://en.wikipedia.org/w/api.php?action=query&list=categorymembers&format=json&cmlimit=500&cmsort=timestamp&cmstart=${\n      cmstart\n    }&cmend=${\n      cmend\n    }&cmtitle=Category:${\n      category\n    }\n  `\n    .trim();\n};\n\nconst movieTitleRandomGet = (\n  text\n) => {\n\n  const query = queryGet(\n    text\n  );\n\n  return mediawikiFetch(\n    query\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        const categorymembers = res.query.categorymembers;\n\n        const title = categorymembers[\n          Math.floor(\n            Math.random() *\n            categorymembers.length\n          )\n        ]\n          .title;\n\n        return (\n          title\n        );\n      }\n    )\n    .then(\n      async (\n        title\n      ) => {\n\n        const movieDataBasic = await movieDataBasicGet(\n          title\n        );\n\n        return (\n          movieDataBasic.plot &&\n          movieDataBasic.cast\n        ) ?\n          title :\n          movieTitleRandomGet(\n            text\n          );\n      }\n    );\n};\n\nexport default movieTitleRandomGet;\n"],"file":"movieTitleRandomGet.js"}