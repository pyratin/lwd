{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/segmentsGet.js"],"names":["__fragmentsGetFn","fragment","character","text","split","reduce","memo","index","textFragment","type","matchIndex","levenMatchText","actorFragment","actor","castIndex","_fragmentsGetFn","fragments","fragmentsGetFn","sentence","characters","fragmentMemo","fragmentIndex","fragmentsGet","plot","segmentIndex","segmentsGetFn","segmentCount","slice","Array","fill","_","filter","segments"],"mappings":"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","sourcesContent":["'use strict';\n\nconst __fragmentsGetFn = (\n  fragment,\n  character\n) => {\n\n  return fragment.text\n    .split(\n      character.text\n    )\n    .reduce(\n      (\n        memo,\n        text\n      ) => {\n\n        return [\n          ...memo,\n          {\n            ...fragment,\n            text\n          }\n        ];\n      },\n      []\n    )\n    .reduce(\n      (\n        memo,\n        fragment,\n        index\n      ) => {\n\n        const textFragment = {\n          type: 'text',\n          ...fragment\n        };\n\n        if (\n          index\n        ) {\n\n          const text = (\n            character.matchIndex ===\n            1\n          ) ?\n            character.levenMatchText :\n            character.text;\n\n          const actorFragment = {\n            ...fragment,\n            type: 'actor',\n            actor: character.actor,\n            text,\n            castIndex: character.castIndex\n          };\n\n          return [\n            ...memo,\n            actorFragment,\n            textFragment\n          ];\n        }\n\n        return [\n          ...memo,\n          textFragment\n        ];\n      },\n      []\n    );\n};\n\nconst _fragmentsGetFn = (\n  fragments,\n  character\n) => {\n\n  return fragments.reduce(\n    (\n      memo,\n      fragment\n    ) => {\n\n      if (\n        fragment.type !==\n        'actor'\n      ) {\n\n        return [\n          ...memo,\n          ...__fragmentsGetFn(\n            fragment,\n            character\n          )\n        ];\n      }\n\n      return [\n        ...memo,\n        fragment\n      ];\n    },\n    []\n  );\n};\n\nconst fragmentsGetFn = (\n  sentence,\n  characters\n) => {\n\n  return characters.reduce(\n    (\n      memo,\n      character\n    ) => {\n\n      const fragments = _fragmentsGetFn(\n        memo,\n        character\n      )\n        .reduce(\n          (\n            fragmentMemo,\n            fragment,\n            fragmentIndex\n          ) => {\n\n            return [\n              ...fragmentMemo,\n              {\n                ...fragment,\n                fragmentIndex\n              }\n            ];\n          },\n          []\n        );\n\n      return (\n        fragments\n      );\n    },\n    [\n      sentence\n    ]\n  );\n};\n\nconst fragmentsGet = (\n  plot,\n  characters\n) => {\n\n  return plot.reduce(\n    (\n      memo,\n      sentence,\n      segmentIndex\n    ) => {\n\n      const fragments = fragmentsGetFn(\n        sentence,\n        characters\n      )\n        .reduce(\n          (\n            memo,\n            fragment\n          ) => {\n\n            return [\n              ...memo,\n              {\n                ...fragment,\n                segmentIndex\n              }\n            ];\n          },\n          []\n        );\n\n      return [\n        ...memo,\n        ...fragments\n      ];\n    },\n    []\n  );\n};\n\nconst segmentsGetFn = (\n  fragments\n) => {\n\n  const segmentCount = fragments.slice(\n    -1\n  )[\n    0\n  ]\n    .segmentIndex;\n\n  return new Array(\n    segmentCount + 1\n  )\n    .fill()\n    .reduce(\n      (\n        memo,\n        _,\n        index\n      ) => {\n\n        return [\n          ...memo,\n          fragments.filter(\n            (\n              fragment\n            ) => {\n\n              return (\n                fragment.segmentIndex ===\n                index\n              );\n            }\n          )\n        ];\n      },\n      []\n    );\n};\n\nexport default (\n  plot,\n  characters\n) => {\n\n  const fragments = fragmentsGet(\n    plot,\n    characters\n  );\n\n  const segments = segmentsGetFn(\n    fragments\n  );\n\n  return (\n    segments\n  );\n};\n"],"file":"segmentsGet.js"}