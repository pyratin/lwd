{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/movieDataBasicPlotGet.js"],"names":["sentencesGetFn","paragraphs","sentences","reduce","memo","paragraph","paragraphIndex","_sentences","map","text","sentenceIndex","sentencesTerminatedGet","length","match","sentencesCulledByLimitGet","plotLimit","_sentence","plotText","$","cheerio","load","plotEl","remove","end","find","toArray","p"],"mappings":"AAAA;;;;;;;;;;;AAEA;;AAEA;;AAEA,IAAMA,cAAc,GAAG,SAAjBA,cAAiB,CACrBC,UADqB,EAElB;AAEH,MAAIC,SAAS,GAAGD,UAAU,CAACE,MAAX,CACd,UACEC,IADF,EAEEC,SAFF,EAGEC,cAHF,EAIK;AAEH,QAAMC,UAAU,GAAG,8BACjBF,SADiB,EAEjB,GAFiB,EAIhBG,GAJgB,CAKf,UACEC,IADF,EAEEC,aAFF,EAGK;AAEH,aAAO;AACLD,QAAAA,IAAI,EAAJA,IADK;AAELH,QAAAA,cAAc,EAAdA,cAFK;AAGLI,QAAAA,aAAa,EAAbA;AAHK,OAAP;AAKD,KAfc,CAAnB;;AAkBA,yDACKN,IADL,uCAEKG,UAFL;AAID,GA7Ba,EA8Bd,EA9Bc,CAAhB;AAiCA,SACEL,SADF;AAGD,CAxCD;;AA0CA,IAAMS,sBAAsB,GAAG,SAAzBA,sBAAyB,CAC7BT,SAD6B,EAE1B;AAAA;;AAEH,SACE,iBAACA,SAAS,CACRA,SAAS,CAACU,MAAV,GAAmB,CADX,CAAV,gDAAC,YAEEH,IAFF,CAEOI,KAFP,CAGG,SAHH,CAAD,CADF;AAOD,CAXD;;AAaA,IAAMC,yBAAyB,GAAG,SAA5BA,yBAA4B,CAChCP,UADgC,EAEhCQ,SAFgC,EAG7B;AAEH,MAAMb,SAAS,GAAGK,UAAU,CAACJ,MAAX,CAChB,UACEC,IADF,EAEEY,SAFF,EAGK;AAEH,YACE,IADF;AAIE,WACE,CAAC,CAACD,SAAF,IAEEX,IAAI,CAACQ,MAAL,IACAG,SAHF,IAKAJ,sBAAsB,CACpBP,IADoB,CANxB;AAWE,eACEA,IADF;;AAIF;AAEE,6DACKA,IADL,IAEEY,SAFF;AArBJ;AA0BD,GAhCe,EAiChB,EAjCgB,CAAlB;;AAoCA,SACEd,SADF;AAGD,CA5CD;;eA8Ce,kBACbe,QADa,EAEbF,SAFa,EAGV;AAEH,MACE,CAACE,QADH,EAEE;AAEA,WACE,IADF;AAGD;;AAED,MAAMC,CAAC,GAAGC,oBAAQC,IAAR,CACRH,QADQ,CAAV;;AAIA,MAAMI,MAAM,GAAGH,CAAC,CACd,2BADc,CAAD,CAGZI,MAHY,GAIZC,GAJY,EAAf;AAMA,MAAItB,UAAU,GAAGoB,MAAM,CACpBG,IADc,CAEb,GAFa,EAIdC,OAJc,EAAjB;;AAMA,MACE,CAACxB,UAAU,CAACW,MADd,EAEE;AAEA,WACE,IADF;AAGD;;AAEDX,EAAAA,UAAU,GAAGA,UAAU,CAACE,MAAX,CACX,UACEC,IADF,EAEEsB,CAFF,EAGK;AAEH,QAAIrB,SAAS,GAAGa,CAAC,CACfQ,CADe,CAAD,CAGbjB,IAHa,EAAhB;AAKA,yDACKL,IAAI,IACP,EAFF,IAGEC,SAHF;AAKD,GAhBU,EAiBX,IAjBW,CAAb;AAoBA,MAAIH,SAAS,GAAGF,cAAc,CAC5BC,UAD4B,CAA9B;AAIAC,EAAAA,SAAS,GAAGY,yBAAyB,CACnCZ,SADmC,EAEnCa,SAFmC,CAArC;AAKA,SACEb,SADF;AAGD,C","sourcesContent":["'use strict';\n\nimport cheerio from 'cheerio';\n\nimport sentencesGet from './sentencesGet';\n\nconst sentencesGetFn = (\n  paragraphs\n) => {\n\n  let sentences = paragraphs.reduce(\n    (\n      memo,\n      paragraph,\n      paragraphIndex\n    ) => {\n\n      const _sentences = sentencesGet(\n        paragraph,\n        100\n      )\n        .map(\n          (\n            text,\n            sentenceIndex\n          ) => {\n\n            return {\n              text,\n              paragraphIndex,\n              sentenceIndex\n            };\n          }\n        );\n\n      return [\n        ...memo,\n        ..._sentences\n      ];\n    },\n    []\n  );\n\n  return (\n    sentences\n  );\n};\n\nconst sentencesTerminatedGet = (\n  sentences\n) => {\n\n  return (\n    !sentences[\n      sentences.length - 1\n    ]?.text.match(\n        /\\s...,$/\n      )\n  );\n};\n\nconst sentencesCulledByLimitGet = (\n  _sentences,\n  plotLimit\n) => {\n\n  const sentences = _sentences.reduce(\n    (\n      memo,\n      _sentence\n    ) => {\n\n      switch (\n        true\n      ) {\n\n        case (\n          !!plotLimit &&\n          (\n            memo.length >=\n            plotLimit\n          ) &&\n          sentencesTerminatedGet(\n            memo\n          )\n        ) :\n\n          return (\n            memo\n          );\n\n        default :\n\n          return [\n            ...memo,\n            _sentence\n          ];\n      }\n    },\n    []\n  );\n\n  return (\n    sentences\n  );\n};\n\nexport default (\n  plotText,\n  plotLimit\n) => {\n\n  if (\n    !plotText\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  const $ = cheerio.load(\n    plotText\n  );\n\n  const plotEl = $(\n    'span.mw-reflink-text, sup'\n  )\n    .remove()\n    .end();\n\n  let paragraphs = plotEl\n    .find(\n      'p'\n    )\n    .toArray();\n\n  if (\n    !paragraphs.length\n  ) {\n\n    return (\n      null\n    );\n  }\n\n  paragraphs = paragraphs.reduce(\n    (\n      memo,\n      p\n    ) => {\n\n      let paragraph = $(\n        p\n      )\n        .text();\n\n      return [\n        ...memo ||\n        [],\n        paragraph\n      ];\n    },\n    null\n  );\n\n  let sentences = sentencesGetFn(\n    paragraphs\n  );\n\n  sentences = sentencesCulledByLimitGet(\n    sentences,\n    plotLimit\n  );\n\n  return (\n    sentences\n  );\n};\n"],"file":"movieDataBasicPlotGet.js"}