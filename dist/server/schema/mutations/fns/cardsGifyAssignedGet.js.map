{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/cardsGifyAssignedGet.js"],"names":["cardsForGifyGet","cards","reduce","cardMemo","card","cardIndex","character","text","textMemo","trim","queryGet","gifyApiKey","process","env","npm_package_config_GIFY_API_KEY","_base64AssignedGetFn","url","then","res","buffer","toString","cardsFlatlistGifyBase64AssignedGetFn","encodeURIComponent","json","data","images","console","log","cardsFlatlistGifyBase64AssignedGet","memo","base64","Promise","resolve","cardByIndexGet","find","cardsGifyBase64AssignedGet","cardsFlatlist","_cardsFlatlist","_cards"],"mappings":"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","sourcesContent":["'use strict';\n\nimport nodeFetch from 'node-fetch';\n\nconst cardsForGifyGet = (\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      cardMemo,\n      card,\n      cardIndex\n    ) => {\n\n      if (\n        !card.character\n      ) {\n\n        return [\n          ...cardMemo,\n          {\n            text: card.text\n              .reduce(\n                (\n                  textMemo,\n                  {\n                    text\n                  }\n                ) => {\n\n                  return `\n                    ${\n                      textMemo.trim()\n                    } ${\n                      text.trim()\n                    }\n                  `\n                    .trim();\n                },\n                ''\n              ),\n            cardIndex\n          }\n        ];\n      }\n\n      return (\n        cardMemo\n      );\n    },\n    []\n  );\n};\n\nconst queryGet = (\n  text\n) => {\n\n  const gifyApiKey = \n    process.env.npm_package_config_GIFY_API_KEY;\n\n  return `\n    https://api.giphy.com/v1/gifs/translate?api_key=${\n      gifyApiKey\n    }&weirdness:=10&s=${\n      text\n    }\n  `\n    .trim();\n};\n\nconst _base64AssignedGetFn = (\n  url\n) => {\n\n  return nodeFetch(\n    url\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        return res.buffer();\n      }\n    )\n    .then(\n      (\n        buffer\n      ) => {\n\n        return `\n          data:image/jpeg;base64,${\n            buffer.toString(\n              'base64'\n            )\n          }\n        `\n          .trim();\n      }\n    );\n};\n\nconst cardsFlatlistGifyBase64AssignedGetFn = (\n  {\n    text\n  }\n) => {\n\n  return nodeFetch(\n    queryGet(\n      encodeURIComponent(\n        text\n      )\n    )\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        return res.json();\n      }\n    )\n    .then(\n      (\n        json\n      ) => {\n\n        const url = json.data.images?.[\n          '480w_still'\n        ]\n          .url;\n\n        if (\n          !url\n        ) {\n\n          //eslint-disable-next-line no-console\n          console.log(\n            `\n              cardsFlatlistGifyBase64AssignedGetFn: ${\n                text\n              }\n            `\n              .trim()\n          );\n\n          return cardsFlatlistGifyBase64AssignedGetFn(\n            {\n              text\n            }\n          );\n        }\n\n        return _base64AssignedGetFn(\n          url\n        );\n      }\n    );\n};\n\nconst cardsFlatlistGifyBase64AssignedGet = (\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      memo,\n      card\n    ) => {\n\n      return memo.then(\n        (\n          res\n        ) => {\n\n          return cardsFlatlistGifyBase64AssignedGetFn(\n            card\n          )\n            .then(\n              (\n                base64\n              ) => {\n\n                return [\n                  ...res,\n                  {\n                    ...card,\n                    base64\n                  }\n                ];\n              }\n            );\n        }\n      );\n    },\n    Promise.resolve(\n      []\n    )\n  );\n};\n\nconst cardByIndexGet = (\n  cards,\n  cardIndex\n) => {\n\n  return cards.find(\n    (\n      card\n    ) => {\n\n      return (\n        card.cardIndex ===\n        cardIndex\n      );\n    }\n  );\n};\n\nconst cardsGifyBase64AssignedGet = (\n  cardsFlatlist,\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      memo,\n      card,\n      cardIndex\n    ) => {\n\n      const _cardsFlatlist = cardByIndexGet(\n        cardsFlatlist,\n        cardIndex\n      );\n\n      if (\n        _cardsFlatlist\n      ) {\n\n        return [\n          ...memo,\n          {\n            ...card,\n            base64: _cardsFlatlist.base64\n          }\n        ];\n      }\n\n      return [\n        ...memo,\n        card\n      ];\n    },\n    []\n  );\n};\n\nexport default async (\n  _cards\n) => {\n\n  let cardsFlatlist = cardsForGifyGet(\n    _cards\n  );\n\n  cardsFlatlist = await cardsFlatlistGifyBase64AssignedGet(\n    cardsFlatlist\n  );\n\n  const cards = cardsGifyBase64AssignedGet(\n    cardsFlatlist,\n    _cards\n  );\n\n  return (\n    cards\n  );\n};\n"],"file":"cardsGifyAssignedGet.js"}