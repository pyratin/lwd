{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/cardsGifyAssignedGet.js"],"names":["cardsForGifyGet","cards","reduce","cardMemo","card","cardIndex","character","text","textMemo","trim","queryGet","process","env","npm_package_config_GIFY_API_KEY","_base64AssignedGetFn","url","then","res","buffer","toString","cardsFlatlistGifyBase64AssignedGetFn","encodeURIComponent","json","randomIndex","Math","floor","random","data","length","memo","_data","index","images","cardsFlatlistGifyBase64AssignedGet","base64","Promise","resolve","cardByIndexGet","find","cardsGifyBase64AssignedGet","cardsFlatlist","_cardsFlatlist","_cards"],"mappings":"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","sourcesContent":["'use strict';\n\nimport nodeFetch from 'node-fetch';\n\nconst cardsForGifyGet = (\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      cardMemo,\n      card,\n      cardIndex\n    ) => {\n\n      if (\n        !card.character\n      ) {\n\n        return [\n          ...cardMemo,\n          {\n            text: card.text\n              .reduce(\n                (\n                  textMemo,\n                  {\n                    text\n                  }\n                ) => {\n\n                  return `\n                    ${\n                      textMemo.trim()\n                    } ${\n                      text.trim()\n                    }\n                  `\n                    .trim();\n                },\n                ''\n              ),\n            cardIndex\n          }\n        ];\n      }\n\n      return (\n        cardMemo\n      );\n    },\n    []\n  );\n};\n\nconst queryGet = (\n  text\n) => {\n\n  return `\n    http://api.giphy.com/v1/gifs/search?api_key=${\n      process.env.npm_package_config_GIFY_API_KEY\n    }&limit=25&rating=pg-13&q=${\n      text\n    }\n  `\n    .trim();\n};\n\nconst _base64AssignedGetFn = (\n  url\n) => {\n\n  return nodeFetch(\n    url\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        return res.buffer();\n      }\n    )\n    .then(\n      (\n        buffer\n      ) => {\n\n        return `\n          data:image/jpeg;base64,${\n            buffer.toString(\n              'base64'\n            )\n          }\n        `\n          .trim();\n      }\n    );\n};\n\nconst cardsFlatlistGifyBase64AssignedGetFn = (\n  {\n    text\n  }\n) => {\n\n  return nodeFetch(\n    queryGet(\n      encodeURIComponent(\n        text\n      )\n    )\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        return res.json();\n      }\n    )\n    .then(\n      (\n        json\n      ) => {\n\n        const randomIndex = Math.floor(\n          Math.random() *\n          json.data.length\n        );\n\n        const url = json.data\n          .reduce(\n            (\n              memo,\n              _data,\n              index\n            ) => {\n\n              if (\n                !memo &&\n                (\n                  index ===\n                  randomIndex\n                )\n              ) {\n\n                return (\n                  _data.images[\n                    '480w_still'\n                  ]\n                    .url\n                );\n              }\n\n              return (\n                memo\n              );\n            },\n            null\n          );\n\n        return (\n          url\n        );\n      }\n    )\n    .then(\n      (\n        url\n      ) => {\n\n        return _base64AssignedGetFn(\n          url\n        );\n      }\n    );\n};\n\nconst cardsFlatlistGifyBase64AssignedGet = (\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      memo,\n      card\n    ) => {\n\n      return memo.then(\n        (\n          res\n        ) => {\n\n          return cardsFlatlistGifyBase64AssignedGetFn(\n            card\n          )\n            .then(\n              (\n                base64\n              ) => {\n\n                return [\n                  ...res,\n                  {\n                    ...card,\n                    base64\n                  }\n                ];\n              }\n            );\n        }\n      );\n    },\n    Promise.resolve(\n      []\n    )\n  );\n};\n\nconst cardByIndexGet = (\n  cards,\n  cardIndex\n) => {\n\n  return cards.find(\n    (\n      card\n    ) => {\n\n      return (\n        card.cardIndex ===\n        cardIndex\n      );\n    }\n  );\n};\n\nconst cardsGifyBase64AssignedGet = (\n  cardsFlatlist,\n  cards\n) => {\n\n  return cards.reduce(\n    (\n      memo,\n      card,\n      cardIndex\n    ) => {\n\n      const _cardsFlatlist = cardByIndexGet(\n        cardsFlatlist,\n        cardIndex\n      );\n\n      if (\n        _cardsFlatlist\n      ) {\n\n        return [\n          ...memo,\n          {\n            ...card,\n            base64: _cardsFlatlist.base64\n          }\n        ];\n      }\n\n      return [\n        ...memo,\n        card\n      ];\n    },\n    []\n  );\n};\n\nexport default async (\n  _cards\n) => {\n\n  let cardsFlatlist = cardsForGifyGet(\n    _cards\n  );\n\n  cardsFlatlist = await cardsFlatlistGifyBase64AssignedGet(\n    cardsFlatlist\n  );\n\n  const cards = cardsGifyBase64AssignedGet(\n    cardsFlatlist,\n    _cards\n  );\n\n  return (\n    cards\n  );\n};\n"],"file":"cardsGifyAssignedGet.js"}