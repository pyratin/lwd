{"version":3,"sources":["../../../../../js/server/schema/mutations/fns/mediawikiFetch.js"],"names":["fnDelay","fn","delay","Promise","resolve","setTimeout","mediawikiFetch","query","then","res","status","console","log","trim","json"],"mappings":"AAAA;;;;;;;;;AAEA;;AAEA,IAAMA,OAAO,GAAG,SAAVA,OAAU,CACdC,EADc,EAEdC,KAFc,EAGX;AAEH,SAAO,IAAIC,OAAJ,CACL,UACEC,OADF,EAEK;AAEH,WAAOC,UAAU,CACf,YAAM;AAEJ,aAAOD,OAAO,CACZH,EAAE,EADU,CAAd;AAGD,KANc,EAOfC,KAPe,CAAjB;AASD,GAdI,CAAP;AAgBD,CArBD;;AAuBA,IAAMI,cAAc,GAAG,SAAjBA,cAAiB,CACrBC,KADqB,EAElB;AAEH,SAAO,2BACLA,KADK,EAGJC,IAHI,CAIH,UACEC,GADF,EAEK;AAEH,QACEA,GAAG,CAACC,MAAJ,KACA,GAFF,EAGE;AAEA;AACAC,MAAAA,OAAO,CAACC,GAAR,CACE,0CAEIH,GAAG,CAACC,MAFR,cAIIH,KAJJ,oBAOGM,IAPH,EADF;AAWA,aAAOb,OAAO,CACZ,YAAM;AAEJ,eAAOM,cAAc,CACnBC,KADmB,CAArB;AAGD,OANW,EAOZ,IAPY,CAAd;AASD;;AAED,WAAOE,GAAG,CAACK,IAAJ,EAAP;AACD,GArCE,CAAP;AAuCD,CA3CD;;eA6CeR,c","sourcesContent":["'use strict';\n\nimport nodeFetch from 'node-fetch';\n\nconst fnDelay = (\n  fn,\n  delay\n) => {\n\n  return new Promise(\n    (\n      resolve\n    ) => {\n\n      return setTimeout(\n        () => {\n\n          return resolve(\n            fn()\n          );\n        },\n        delay\n      );\n    }\n  ); \n};\n\nconst mediawikiFetch = (\n  query\n) => {\n\n  return nodeFetch(\n    query\n  )\n    .then(\n      (\n        res\n      ) => {\n\n        if (\n          res.status ===\n          429\n        ) {\n\n          // eslint-disable-next-line no-console\n          console.log(\n            `\n              mediawikiFetch: ${\n                res.status\n              } ${\n                query\n              }\n            `\n              .trim()\n          );\n\n          return fnDelay(\n            () => {\n\n              return mediawikiFetch(\n                query\n              );\n            },\n            2000\n          );\n        }\n\n        return res.json();\n      }\n    );\n};\n\nexport default mediawikiFetch;\n"],"file":"mediawikiFetch.js"}